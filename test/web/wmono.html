<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <script src="../../dist/cjs-bundle/index.js"></script>
    </head>
    <body style="position: absolute; width: 100%; height: 100%; margin: 0px">
    </body>
    <script>
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        code = `
import("stdfaust.lib");
process = ba.pulsen(1, 10000) : pm.djembe(60, 0.3, 0.4, 1) <: dm.freeverb_demo;`;
        const { instantiateFaustModule, LibFaust, FaustCompiler, FaustMonoDspGenerator } = faustwasm;
        (async () => {
            faustModule = await instantiateFaustModule();
            libFaust = new LibFaust(faustModule);
            compiler = new FaustCompiler(libFaust);
            generator = new FaustMonoDspGenerator();
            await generator.compile(compiler, "dsp", code, "");
            node = await generator.createNode(audioCtx);

            node.connect(audioCtx.destination);
        })();
        const unlockAudioContext = (audioCtx) => {
            if (audioCtx.state !== "suspended") return;
            const b = document.body;
            const events = ["touchstart", "touchend", "mousedown", "keydown"];
            const unlock = () => audioCtx.resume().then(clean);
            const clean = () => events.forEach(e => b.removeEventListener(e, unlock));
            events.forEach(e => b.addEventListener(e, unlock, false));
        }
        unlockAudioContext(audioCtx);
    </script>
</html>